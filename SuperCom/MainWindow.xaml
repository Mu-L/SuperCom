<super:BaseWindow
    x:Class="SuperCom.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
    xmlns:cmd="clr-namespace:SuperCom.Commands"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
    xmlns:local="clr-namespace:SuperCom"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:super="https://github.com/SuperStudio/SuperControls"
    Name="mainWindow"
    Title="SuperCom-超级串口工具"
    Width="1000"
    Height="500"
    MinWidth="600"
    Background="{DynamicResource Window.Background}"
    Closing="mainWindow_Closing"
    ContentRendered="mainWindow_ContentRendered"
    Foreground="{DynamicResource Window.Foreground}"
    TitleHeight="0"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <super:BaseWindow.Resources>
        <Style x:Key="BgHoverBorder" TargetType="Border">
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="CornerRadius" Value="0" />
            <Setter Property="Background" Value="{DynamicResource Window.Title.Background}" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Opacity" Value="0.8" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource Window.Title.Hover.Background}" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </super:BaseWindow.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="30" />
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <Border
            x:Name="TitleBorder"
            Grid.Row="0"
            Background="{DynamicResource Window.Title.Background}"
            BorderThickness="0"
            MouseMove="MoveWindow"
            PreviewMouseLeftButtonDown="MaxCurrentWindow">
            <Border.ContextMenu>
                <ContextMenu>
                    <MenuItem Click="MinWindow" Header="最小化" />
                    <MenuItem
                        Name="MaxMenuItem"
                        Click="OnMaxWindow"
                        Header="最大化" />
                    <MenuItem Click="CloseWindow" Header="关闭" />
                </ContextMenu>
            </Border.ContextMenu>
            <Grid Panel.ZIndex="50">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition Width="auto" />
                    </Grid.ColumnDefinitions>
                    <StackPanel
                        Grid.Column="0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <Image
                            Height="25"
                            Margin="5,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Source="/Resources/Ico/ICON_64.png" />
                        <TextBlock Style="{StaticResource BaseTextBlock}" Text="{Binding ElementName=mainWindow, Path=Title}" />

                    </StackPanel>
                    <StackPanel
                        Grid.Column="1"
                        Margin="20,0"
                        Orientation="Horizontal">
                        <Button
                            Width="70"
                            super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                            Click="OpenContextMenu"
                            Content="文件"
                            Style="{StaticResource TitleButton}">
                            <Button.ContextMenu>
                                <ContextMenu
                                    HorizontalOffset="-40"
                                    StaysOpen="True"
                                    VerticalOffset="10">
                                    <MenuItem
                                        Click="OpenLog"
                                        Header="打开日志"
                                        IsCheckable="False" />

                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>
                        <Button
                            Width="70"
                            super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                            Click="OpenContextMenu"
                            Content="视图"
                            Style="{StaticResource TitleButton}">
                            <Button.ContextMenu>
                                <ContextMenu
                                    HorizontalOffset="-40"
                                    StaysOpen="True"
                                    VerticalOffset="10">
                                    <MenuItem
                                        Name="sideGridMenuItem"
                                        Click="HideSide"
                                        Header="侧边栏"
                                        IsCheckable="True"
                                        IsChecked="True" />

                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>

                    </StackPanel>
                </Grid>




                <StackPanel
                    Name="TitleStackPanel"
                    Grid.Column="1"
                    Height="30"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal">

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="auto" />
                        </Grid.ColumnDefinitions>


                        <Button
                            Grid.Column="0"
                            Width="40"
                            VerticalAlignment="Stretch"
                            super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                            Click="SplitPanel"
                            Style="{StaticResource FlatButton}">
                            <Canvas>
                                <Rectangle
                                    Canvas.Left="-11"
                                    Canvas.Top="-7"
                                    Width="8"
                                    Height="15"
                                    RadiusX="2"
                                    RadiusY="2"
                                    Stroke="{DynamicResource Window.Foreground}"
                                    StrokeThickness="1.5" />

                                <Rectangle
                                    Canvas.Left="-1"
                                    Canvas.Top="-8"
                                    Width="1"
                                    Height="18"
                                    Fill="{DynamicResource Window.Foreground}" />
                                <Rectangle
                                    Canvas.Left="2"
                                    Canvas.Top="-7"
                                    Width="8"
                                    Height="15"
                                    RadiusX="2"
                                    RadiusY="2"
                                    Stroke="{DynamicResource Window.Foreground}"
                                    StrokeThickness="1.5" />
                            </Canvas>
                        </Button>



                        <Button
                            Name="panelSplitBtn"
                            Grid.Column="1"
                            Width="15"
                            Margin="0"
                            Padding="0"
                            VerticalAlignment="Stretch"
                            super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                            Click="ShowSplitPopup"
                            Style="{StaticResource FlatButton}">
                            <Viewbox
                                Width="8"
                                Height="auto"
                                VerticalAlignment="Center">
                                <Path
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Data="M585.246075 875.340272l408.227201-447.966132c57.440818-63.040395 12.824837-164.374669-72.613865-164.374669H104.224378c-85.25807 0-130.054683 101.334274-72.613865 164.374669l408.407832 447.7855c39.016405 42.809667 106.211325 42.809667 145.22773 0.180632z"
                                    Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                            </Viewbox>
                        </Button>



                        <Popup
                            x:Name="panelSplitPopup"
                            Width="auto"
                            Height="60"
                            AllowsTransparency="True"
                            HorizontalOffset="-80"
                            Placement="Bottom"
                            PlacementTarget="{Binding ElementName=panelSplitBtn}"
                            PopupAnimation="Fade"
                            StaysOpen="False"
                            VerticalOffset="0">
                            <Grid Margin="5">
                                <Border
                                    Margin="5"
                                    Background="{DynamicResource Menu.Background}"
                                    CornerRadius="5"
                                    Effect="{StaticResource PopupDropShadowEffect}" />
                                <StackPanel Margin="5" Orientation="Horizontal">

                                    <Button
                                        Grid.Column="0"
                                        Width="40"
                                        VerticalAlignment="Stretch"
                                        super:CommonExt.CornerRadius="5"
                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                        Click="SplitPanel"
                                        Style="{StaticResource FlatButton}">
                                        <Canvas>
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="-9"
                                                Width="19"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="2"
                                                Width="19"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />

                                            <Rectangle
                                                Canvas.Left="-10"
                                                Width="19"
                                                Height="1"
                                                Fill="{DynamicResource Window.Foreground}" />
                                        </Canvas>
                                    </Button>
                                    <Button
                                        Grid.Column="0"
                                        Width="40"
                                        VerticalAlignment="Stretch"
                                        super:CommonExt.CornerRadius="5"
                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                        Click="SplitPanel"
                                        Style="{StaticResource FlatButton}">
                                        <Canvas>
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="-9"
                                                Width="8"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="2"
                                                Width="8"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                            <Rectangle
                                                Canvas.Left="-1"
                                                Canvas.Top="-9"
                                                Width="1"
                                                Height="19"
                                                Fill="{DynamicResource Window.Foreground}" />

                                            <Rectangle
                                                Canvas.Left="-10"
                                                Width="19"
                                                Height="1"
                                                Fill="{DynamicResource Window.Foreground}" />
                                            <Rectangle
                                                Canvas.Left="1"
                                                Canvas.Top="-9"
                                                Width="8"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                            <Rectangle
                                                Canvas.Left="1"
                                                Canvas.Top="2"
                                                Width="8"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                        </Canvas>
                                    </Button>
                                    <Button
                                        Grid.Column="0"
                                        Width="40"
                                        VerticalAlignment="Stretch"
                                        super:CommonExt.CornerRadius="5"
                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                        Click="SplitPanel"
                                        Style="{StaticResource FlatButton}">
                                        <Canvas>
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="-9"
                                                Width="8"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="2"
                                                Width="19"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                            <Rectangle
                                                Canvas.Left="-1"
                                                Canvas.Top="-9"
                                                Width="1"
                                                Height="10"
                                                Fill="{DynamicResource Window.Foreground}" />

                                            <Rectangle
                                                Canvas.Left="-10"
                                                Width="19"
                                                Height="1"
                                                Fill="{DynamicResource Window.Foreground}" />
                                            <Rectangle
                                                Canvas.Left="1"
                                                Canvas.Top="-9"
                                                Width="8"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                        </Canvas>
                                    </Button>
                                    <Button
                                        Grid.Column="0"
                                        Width="40"
                                        VerticalAlignment="Stretch"
                                        super:CommonExt.CornerRadius="5"
                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                        Click="SplitPanel"
                                        Style="{StaticResource FlatButton}">
                                        <Canvas>
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="-9"
                                                Width="19"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="2"
                                                Width="8"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                            <Rectangle
                                                Canvas.Left="-1"
                                                Width="1"
                                                Height="10"
                                                Fill="{DynamicResource Window.Foreground}" />

                                            <Rectangle
                                                Canvas.Left="-10"
                                                Width="19"
                                                Height="1"
                                                Fill="{DynamicResource Window.Foreground}" />
                                            <Rectangle
                                                Canvas.Left="1"
                                                Canvas.Top="2"
                                                Width="8"
                                                Height="8"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                        </Canvas>
                                    </Button>
                                    <Button
                                        Grid.Column="0"
                                        Width="40"
                                        VerticalAlignment="Stretch"
                                        super:CommonExt.CornerRadius="5"
                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                        Click="SplitPanel"
                                        Style="{StaticResource FlatButton}">
                                        <Canvas>
                                            <Rectangle
                                                Canvas.Left="-10"
                                                Canvas.Top="-9"
                                                Width="19"
                                                Height="19"
                                                RadiusX="1"
                                                RadiusY="1"
                                                Stroke="{DynamicResource Window.Foreground}"
                                                StrokeThickness="1.5" />
                                        </Canvas>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Popup>
                    </Grid>



                    <Button
                        Name="themeButton"
                        Width="40"
                        Style="{StaticResource FlatButton}"
                        Tag="{DynamicResource Window.Title.Hover.Background}"
                        Visibility="Collapsed">
                        <Viewbox
                            Width="15"
                            Height="auto"
                            VerticalAlignment="Center">
                            <Path
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Data="M758.35 121.71H704.7c-14.19 0-27.88 6.14-37.04 17.11-27.48 32.81-106.09 54.05-155.61 54.05s-128.13-21.24-155.61-54.05c-9.26-10.98-22.85-17.11-37.04-17.11h-53.75c-13.08 0-25.57 5.23-34.83 14.7L52.56 317.69c-11.48 11.67-11.48 30.5 0 42.17l108.7 110.62c11.48 11.68 30 11.68 41.47 0l3.62-3.62c3.93-3.93 10.57-1.21 10.57 4.43V856.9c0 25.06 19.93 45.39 44.59 45.39h500.95c24.66 0 44.59-20.33 44.59-45.39V471.19c0-5.64 6.64-8.46 10.57-4.43l3.62 3.63c11.48 11.67 30 11.67 41.47 0l108.7-110.62c11.48-11.67 11.48-30.5 0-42.17L793.18 136.31c-9.26-9.36-21.84-14.6-34.83-14.6z"
                                Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                        </Viewbox>
                    </Button>


                    <Button
                        Width="40"
                        Margin="0"
                        Padding="0"
                        VerticalAlignment="Stretch"
                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                        Click="MinWindow"
                        Style="{StaticResource FlatButton}">
                        <Viewbox
                            Width="12"
                            Height="auto"
                            VerticalAlignment="Center">
                            <Path
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Data="M512 0h6144c307.2 0 512 204.8 512 512s-204.8 512-512 512H512c-307.2 0-512-204.8-512-512s204.8-512 512-512z"
                                Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                        </Viewbox>
                    </Button>
                    <Button
                        Name="ButtonMax"
                        Width="40"
                        Margin="0"
                        Padding="0"
                        VerticalAlignment="Stretch"
                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                        Click="OnMaxWindow"
                        Style="{StaticResource FlatButton}">
                        <Viewbox
                            Width="12"
                            Height="auto"
                            VerticalAlignment="Center">
                            <Path
                                x:Name="MaxPath"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Data="M834.688 1024H189.312A189.568 189.568 0 0 1 0 834.688V189.312A189.568 189.568 0 0 1 189.312 0h645.376A189.568 189.568 0 0 1 1024 189.312v645.376A189.482667 189.482667 0 0 1 834.688 1024zM189.312 99.712a89.6 89.6 0 0 0-89.6 89.6v645.376a89.6 89.6 0 0 0 89.6 89.6h645.376a89.6 89.6 0 0 0 89.6-89.6V189.312a89.6 89.6 0 0 0-89.6-89.6z"
                                Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                        </Viewbox>
                    </Button>
                    <Button
                        Name="ButtonClose"
                        Width="40"
                        Margin="0"
                        Padding="0"
                        VerticalAlignment="Stretch"
                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Deep.Background}"
                        Click="CloseWindow"
                        Style="{StaticResource FlatButton}">
                        <Viewbox
                            Width="12"
                            Height="auto"
                            VerticalAlignment="Center">
                            <Path
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Data="M610.218667 505.6l398.08-387.413333a49.664 49.664 0 0 0 0-71.338667l-2.133334-2.133333a52.992 52.992 0 0 0-73.301333 0L534.784 432.64 136.704 44.373333a52.992 52.992 0 0 0-73.386667 0L61.269333 46.592a48.810667 48.810667 0 0 0 0 71.338667l398.165334 387.669333-398.165334 387.498667a49.664 49.664 0 0 0 0 71.253333l2.218667 2.133333c20.48 19.626667 52.821333 19.626667 73.301333 0l398.08-387.413333 398.08 387.413333c20.48 19.626667 52.906667 19.626667 73.386667 0l2.048-2.133333a49.664 49.664 0 0 0 0-71.253333l-398.08-387.413334z"
                                Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                        </Viewbox>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition
                    Name="SideGridColumn"
                    Width="{Binding SideGridWidth, FallbackValue=200, Mode=OneWay}"
                    MaxWidth="500" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Border
                Name="sideBorder"
                Grid.Column="0"
                Background="{DynamicResource Window.Side.Background}"
                SizeChanged="Border_SizeChanged">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="auto" />
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="auto" />

                        </Grid.ColumnDefinitions>
                        <Border
                            Margin="5"
                            MouseLeftButtonUp="RefreshPortsStatus"
                            Style="{StaticResource RoundHoverBorder}">
                            <Viewbox Width="auto" Height="13">
                                <Path
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Data="M848.738462 608.137846c-8.467692 178.097231-155.963077 319.881846-336.659693 319.881846-186.171077 0-337.132308-150.449231-337.132307-336.068923 0-180.145231 142.178462-327.168 320.787692-335.675077v159.82277l353.122461-192.039385L495.734154 0v160.098462C263.995077 168.684308 78.769231 358.754462 78.769231 591.872 78.769231 830.542769 272.777846 1024 512.157538 1024 746.062769 1024 936.644923 839.286154 945.230769 608.137846h-96.492307z"
                                    Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                            </Viewbox>
                        </Border>

                        <Border
                            Grid.Column="1"
                            MouseUp="ShowContextMenu"
                            Style="{StaticResource RoundHoverBorder}">
                            <Border.ContextMenu>
                                <ContextMenu HorizontalOffset="-50">

                                    <MenuItem Click="OpenAllPort" Header="打开所有串口" />
                                    <MenuItem Click="CloseAllPort" Header="关闭所有串口" />
                                </ContextMenu>
                            </Border.ContextMenu>
                            <Viewbox Width="auto" Height="13">
                                <Path
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Data="M897.427256 249.003144 126.57172 249.003144c-34.673707 0-62.73174-28.088732-62.73174-62.73174s28.058033-62.73174 62.73174-62.73174l770.855536 0c34.673707 0 62.73174 28.088732 62.73174 62.73174S932.101987 249.003144 897.427256 249.003144z M897.427256 574.73174 126.57172 574.73174c-34.673707 0-62.73174-28.088732-62.73174-62.73174s28.058033-62.73174 62.73174-62.73174l770.855536 0c34.673707 0 62.73174 28.088732 62.73174 62.73174S932.101987 574.73174 897.427256 574.73174z M897.427256 900.460336 126.57172 900.460336c-34.673707 0-62.73174-28.088732-62.73174-62.73174 0-34.643008 28.058033-62.73174 62.73174-62.73174l770.855536 0c34.673707 0 62.73174 28.088732 62.73174 62.73174C960.16002 872.371604 932.101987 900.460336 897.427256 900.460336z"
                                    Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                            </Viewbox>
                        </Border>




                    </Grid>
                    <ListBox
                        Grid.Row="1"
                        HorizontalContentAlignment="Stretch"
                        d:ItemsSource="{d:SampleData ItemCount=5}"
                        Background="Transparent"
                        ItemsSource="{Binding SideComPorts}"
                        ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                        Style="{StaticResource NormalListBox}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid
                                    Background="{DynamicResource ListBoxItem.Background}"
                                    PreviewMouseLeftButtonDown="Grid_PreviewMouseLeftButtonDown"
                                    Tag="{Binding Name}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Click="Remark" Header="备注" />
                                        </ContextMenu>
                                    </Grid.ContextMenu>
                                    <Border
                                        Grid.Column="0"
                                        Width="10"
                                        Height="10"
                                        Margin="5"
                                        CornerRadius="10">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="Green" />
                                                <Style.Triggers>

                                                    <DataTrigger Binding="{Binding Connected}" Value="True">
                                                        <Setter Property="Background" Value="Red" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                    </Border>
                                    <TextBlock
                                        Grid.Column="1"
                                        MaxWidth="120"
                                        Margin="0"
                                        Padding="10,5"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="{Binding Name}"
                                        TextTrimming="WordEllipsis"
                                        TextWrapping="WrapWithOverflow" />
                                    <TextBlock
                                        Grid.Column="2"
                                        MaxWidth="120"
                                        Margin="0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="{Binding Remark, UpdateSourceTrigger=PropertyChanged}"
                                        TextTrimming="WordEllipsis"
                                        TextWrapping="WrapWithOverflow" />
                                    <Button
                                        Grid.Column="3"
                                        Margin="5"
                                        HorizontalAlignment="Right"
                                        Click="ConnectPort"
                                        Tag="{Binding Name}">
                                        <Button.Style>
                                            <Style BasedOn="{StaticResource FillButton}" TargetType="Button">
                                                <Setter Property="Content" Value="连接" />
                                                <Setter Property="Visibility" Value="Hidden" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Connected}" Value="True">

                                                        <Setter Property="Content" Value="断开" />
                                                        <Setter Property="Background" Value="Red" />
                                                        <Setter Property="super:CommonExt.HoverBackground" Value="Red" />
                                                    </DataTrigger>

                                                    <DataTrigger Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Grid}, Mode=FindAncestor}}" Value="true">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>

                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>





                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            Grid.Column="0"
                            Padding="10,0"
                            VerticalAlignment="Center"
                            FontSize="15"
                            FontWeight="Bold"
                            Foreground="Gold"
                            Text="SuperCom" />
                        <Border
                            Grid.Column="1"
                            Width="30"
                            Height="30"
                            Margin="5"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            CornerRadius="5"
                            MouseUp="ShowSettingsPopup"
                            Style="{StaticResource HoverBorder}">
                            <Border.ContextMenu>
                                <ContextMenu HorizontalOffset="-40">
                                    <MenuItem Click="OpenSetting" Header="设置" />
                                    <MenuItem Command="cmd:OpenWindow.Upgrade" Header="检查更新" />
                                    <MenuItem Click="ShowAbout" Header="关于" />
                                </ContextMenu>
                            </Border.ContextMenu>
                            <Viewbox
                                Width="20"
                                Height="auto"
                                VerticalAlignment="Center">
                                <Path Data="M940 596l-76-57.6c0.8-8 1.6-16.8 1.6-26.4s-0.8-18.4-1.6-26.4l76-57.6c20.8-16 26.4-44 12.8-68l-84.8-143.2c-9.6-16.8-28-27.2-47.2-27.2-6.4 0-12 0.8-18.4 3.2L712 228c-15.2-10.4-31.2-19.2-47.2-26.4l-13.6-92c-4-26.4-26.4-45.6-53.6-45.6H426.4c-27.2 0-49.6 19.2-53.6 44.8L360 201.6c-16 7.2-31.2 16-47.2 26.4l-90.4-35.2c-6.4-2.4-12.8-3.2-19.2-3.2-19.2 0-37.6 9.6-46.4 26.4L71.2 360c-13.6 22.4-8 52 12.8 68l76 57.6c-0.8 9.6-1.6 18.4-1.6 26.4s0 16.8 1.6 26.4l-76 57.6c-20.8 16-26.4 44-12.8 68l84.8 143.2c9.6 16.8 28 27.2 47.2 27.2 6.4 0 12-0.8 18.4-3.2L312 796c15.2 10.4 31.2 19.2 47.2 26.4l13.6 92c3.2 25.6 26.4 45.6 53.6 45.6h171.2c27.2 0 49.6-19.2 53.6-44.8l13.6-92.8c16-7.2 31.2-16 47.2-26.4l90.4 35.2c6.4 2.4 12.8 3.2 19.2 3.2 19.2 0 37.6-9.6 46.4-26.4l85.6-144.8c12.8-23.2 7.2-51.2-13.6-67.2zM704 512c0 105.6-86.4 192-192 192S320 617.6 320 512s86.4-192 192-192 192 86.4 192 192z" Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                            </Viewbox>
                        </Border>
                    </Grid>
                </Grid>
            </Border>
            <GridSplitter
                Grid.Column="1"
                Width="4"
                HorizontalAlignment="Left"
                Panel.ZIndex="10"
                Style="{StaticResource HoverSpliter}" />

            <Popup
                x:Name="hexTransPopup"
                Grid.ColumnSpan="3"
                Width="300"
                Height="auto"
                Margin="0,0,700,0"
                AllowsTransparency="True"
                HorizontalOffset="-150"
                Placement="Mouse"
                PopupAnimation="Fade"
                StaysOpen="False"
                VerticalOffset="-80">
                <Grid Margin="5">
                    <Border
                        Margin="5"
                        Background="{DynamicResource Menu.Background}"
                        CornerRadius="5"
                        Effect="{StaticResource PopupDropShadowEffect}" />
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <TextBlock
                                Grid.Row="0"
                                FontWeight="Bold"
                                Text="HEX" />
                            <super:Switch
                                Name="HexToStrSwitch"
                                Height="16"
                                Margin="20,0,5,0"
                                BorderBrush="{DynamicResource Window.Title.Background}"
                                Click="Switch_Click" />
                            <TextBlock
                                Margin="0"
                                FontSize="12"
                                Style="{StaticResource BaseTextBlock}"
                                Text="大写" />


                        </StackPanel>
                        <ToggleButton
                            Width="auto"
                            Height="auto"
                            Margin="5,0"
                            Padding="2,2,4,2"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            Click="SetStayOpenStatus"
                            Style="{StaticResource FlatToggleButton}">
                            <Viewbox
                                Width="15"
                                Height="auto"
                                VerticalAlignment="Center">
                                <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                            </Viewbox>
                        </ToggleButton>

                        <Border
                            Grid.Row="1"
                            Margin="0,10"
                            Padding="5"
                            Background="{DynamicResource Window.Title.Background}"
                            CornerRadius="5">
                            <TextBox
                                Name="HexTextBox"
                                Grid.Row="1"
                                MaxHeight="100"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                ContextMenu="{StaticResource TextBoxContextMenu}"
                                Style="{StaticResource MultiLineTextBox}"
                                VerticalScrollBarVisibility="Auto" />
                        </Border>



                        <TextBlock
                            Grid.Row="2"
                            FontWeight="Bold"
                            Text="字符串" />

                        <Border
                            Grid.Row="3"
                            Margin="0,10,0,0"
                            Padding="5"
                            Background="{DynamicResource Window.Title.Background}"
                            CornerRadius="5">
                            <TextBox
                                Name="StrTextBox"
                                Grid.Row="1"
                                MaxHeight="100"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                ContextMenu="{StaticResource TextBoxContextMenu}"
                                Style="{StaticResource MultiLineTextBox}"
                                VerticalScrollBarVisibility="Auto" />
                        </Border>

                        <WrapPanel
                            Grid.Row="4"
                            Margin="0,10"
                            Orientation="Horizontal">
                            <Button
                                Margin="0,0,5,0"
                                Click="HexToStr"
                                Content="Hex =&gt; Str"
                                Style="{StaticResource ButtonPrimary}" />
                            <Button
                                Margin="5,0"
                                Click="StrToHex"
                                Content="Str =&gt; Hex"
                                Style="{StaticResource ButtonPrimary}" />
                        </WrapPanel>

                    </Grid>

                </Grid>
            </Popup>
            <Popup
                x:Name="timeTransPopup"
                Grid.ColumnSpan="3"
                Width="330"
                Height="auto"
                Margin="0,0,670,0"
                AllowsTransparency="True"
                HorizontalOffset="-150"
                Placement="Mouse"
                PopupAnimation="Fade"
                StaysOpen="True"
                VerticalOffset="-120">
                <Grid Margin="5">
                    <Border
                        Margin="5"
                        Background="{DynamicResource Menu.Background}"
                        CornerRadius="5"
                        Effect="{StaticResource PopupDropShadowEffect}" />
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <TextBlock
                                Grid.Row="0"
                                VerticalAlignment="Center"
                                FontWeight="Bold"
                                Text="时间戳" />

                            <ComboBox
                                Name="TimeComboBox"
                                Width="100"
                                Margin="20,0"
                                FontSize="10"
                                SelectedIndex="0"
                                Style="{StaticResource BorderComboBox}">
                                <ComboBoxItem Content="秒(s)" />
                                <ComboBoxItem Content="毫秒(ms)" />
                            </ComboBox>


                        </StackPanel>

                        <ToggleButton
                            Width="auto"
                            Height="auto"
                            Margin="5,0"
                            Padding="2,2,4,2"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            Click="SetStayOpenStatus"
                            Style="{StaticResource FlatToggleButton}">
                            <Viewbox
                                Width="15"
                                Height="auto"
                                VerticalAlignment="Center">
                                <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                            </Viewbox>
                        </ToggleButton>

                        <Border
                            Grid.Row="1"
                            Margin="0,10"
                            Padding="5"
                            Background="{DynamicResource Window.Title.Background}"
                            CornerRadius="5">
                            <TextBox
                                Name="TimeStampTextBox"
                                Grid.Row="1"
                                MaxHeight="100"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                ContextMenu="{StaticResource TextBoxContextMenu}"
                                Style="{StaticResource MultiLineTextBox}"
                                VerticalScrollBarVisibility="Auto" />
                        </Border>



                        <TextBlock
                            Grid.Row="2"
                            FontWeight="Bold"
                            Text="北京时间" />

                        <Border
                            Grid.Row="3"
                            Margin="0,10,0,0"
                            Padding="5"
                            Background="{DynamicResource Window.Title.Background}"
                            CornerRadius="5">
                            <TextBox
                                Name="LocalTimeTextBox"
                                Grid.Row="1"
                                MaxHeight="100"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                ContextMenu="{StaticResource TextBoxContextMenu}"
                                Style="{StaticResource MultiLineTextBox}"
                                VerticalScrollBarVisibility="Auto" />
                        </Border>

                        <WrapPanel
                            Grid.Row="4"
                            Margin="0,10"
                            Orientation="Horizontal">
                            <Button
                                Margin="0,0,5,0"
                                Click="TimeStampToLocalTime"
                                Content="时间戳 =&gt; 北京时间"
                                Style="{StaticResource ButtonPrimary}" />
                            <Button
                                Margin="5,0"
                                Click="LocalTimeToTimeStamp"
                                Content="北京时间 =&gt; 时间戳"
                                Style="{StaticResource ButtonPrimary}" />
                        </WrapPanel>

                    </Grid>

                </Grid>
            </Popup>
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <ScrollViewer
                    Grid.Row="0"
                    HorizontalScrollBarVisibility="Auto"
                    PreviewMouseWheel="scrollViewer_PreviewMouseWheel"
                    VerticalScrollBarVisibility="Hidden">
                    <ItemsControl ItemsSource="{Binding PortTabItems}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Height="35"
                                    MinWidth="150"
                                    BorderThickness="1"
                                    Cursor="Hand"
                                    PreviewMouseLeftButtonDown="Border_PreviewMouseLeftButtonDown"
                                    Tag="{Binding Name}">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{DynamicResource TabItem.Background}" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Selected}" Value="True">
                                                    <Setter Property="Background" Value="{DynamicResource ListBoxItem.Selected.Active.Background}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Border.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Click="Remark" Header="备注" />
                                        </ContextMenu>
                                    </Border.ContextMenu>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>
                                        <Border
                                            Grid.Column="0"
                                            Width="10"
                                            Height="10"
                                            Margin="5"
                                            CornerRadius="10">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="Green" />
                                                    <Style.Triggers>

                                                        <DataTrigger Binding="{Binding Connected}" Value="True">
                                                            <Setter Property="Background" Value="Red" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                        </Border>
                                        <TextBlock
                                            Grid.Column="1"
                                            MaxWidth="120"
                                            Margin="0"
                                            Padding="10,5"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Style="{StaticResource BaseTextBlock}"
                                            Text="{Binding Name}"
                                            TextTrimming="WordEllipsis"
                                            TextWrapping="WrapWithOverflow" />
                                        <TextBlock
                                            Grid.Column="2"
                                            Margin="0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Style="{StaticResource BaseTextBlock}"
                                            Text="{Binding Remark}"
                                            TextTrimming="WordEllipsis"
                                            TextWrapping="WrapWithOverflow" />

                                        <Border
                                            x:Name="border"
                                            Grid.Column="3"
                                            Background="Transparent"
                                            BorderBrush="{StaticResource TabItem.Selected.Background}">
                                            <Button
                                                Width="20"
                                                Height="20"
                                                Margin="5"
                                                HorizontalAlignment="Right"
                                                Click="CloseTabItem"
                                                Style="{StaticResource RoundNormalButton}"
                                                Tag="{DynamicResource TabItem.Hover.Background}"
                                                Visibility="Visible">
                                                <Viewbox
                                                    Width="10"
                                                    Height="auto"
                                                    VerticalAlignment="Center">
                                                    <Path
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Data="M610.218667 505.6l398.08-387.413333a49.664 49.664 0 0 0 0-71.338667l-2.133334-2.133333a52.992 52.992 0 0 0-73.301333 0L534.784 432.64 136.704 44.373333a52.992 52.992 0 0 0-73.386667 0L61.269333 46.592a48.810667 48.810667 0 0 0 0 71.338667l398.165334 387.669333-398.165334 387.498667a49.664 49.664 0 0 0 0 71.253333l2.218667 2.133333c20.48 19.626667 52.821333 19.626667 73.301333 0l398.08-387.413333 398.08 387.413333c20.48 19.626667 52.906667 19.626667 73.386667 0l2.048-2.133333a49.664 49.664 0 0 0 0-71.253333l-398.08-387.413334z"
                                                        Fill="{DynamicResource TabItem.Hover.Foreground}" />
                                                </Viewbox>
                                            </Button>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                <ItemsControl
                    Name="itemsControl"
                    Grid.Row="1"
                    Background="Transparent"
                    ItemsSource="{Binding PortTabItems}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Grid />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>



                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid
                                Name="baseGrid"
                                Background="{DynamicResource Window.Background}"
                                Tag="{Binding Name}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" MinHeight="100" />
                                    <RowDefinition Height="5" />
                                    <RowDefinition Height="auto" />
                                </Grid.RowDefinitions>


                                <Grid
                                    Name="rootGrid"
                                    Grid.Row="0"
                                    Tag="{Binding Name}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="auto" />
                                    </Grid.RowDefinitions>
                                    <Border
                                        Grid.Row="0"
                                        Padding="10"
                                        Background="{DynamicResource TabItem.Background}"
                                        PreviewMouseWheel="Border_PreviewMouseWheel">

                                        <avalonEdit:TextEditor
                                            Name="textBox"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            FontFamily="微软雅黑"
                                            FontSize="10pt"
                                            Foreground="{DynamicResource Window.Foreground}"
                                            IsReadOnly="True"
                                            ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                                            SyntaxHighlighting="ComLog"
                                            TextChanged="TextBox_TextChanged">
                                            <avalonEdit:TextEditor.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Command="ApplicationCommands.SelectAll" Header="全选" />
                                                    <MenuItem Click="CopyText" Header="复制" />
                                                    <MenuItem Click="OpenHexTransform" Header="HEX 转换" />
                                                    <MenuItem Click="OpenTimeTransform" Header="时间戳" />
                                                </ContextMenu>
                                            </avalonEdit:TextEditor.ContextMenu>
                                        </avalonEdit:TextEditor>

                                        <!--<TextBox
                                            Name="textBox"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Foreground="{DynamicResource Window.Foreground}"
                                            IsReadOnly="True"
                                            ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                                            TextChanged="TextBox_TextChanged">
                                            <TextBox.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Command="ApplicationCommands.Copy" Header="复制" />

                                                    <MenuItem Click="OpenHexTransform" Header="HEX 转换" />
                                                    <MenuItem Click="OpenTimeTransform" Header="时间戳" />
                                                </ContextMenu>
                                            </TextBox.ContextMenu>
                                        </TextBox>-->


                                    </Border>


                                    <StackPanel
                                        Grid.Row="0"
                                        Margin="30,20"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Bottom"
                                        Panel.ZIndex="99"
                                        Orientation="Vertical">

                                        <Border
                                            Width="25"
                                            Height="25"
                                            CornerRadius="5 5 0 0"
                                            MouseLeftButtonUp="GotoTop"
                                            Style="{StaticResource BgHoverBorder}"
                                            ToolTip="去到顶部">

                                            <Viewbox
                                                Width="15"
                                                Height="auto"
                                                VerticalAlignment="Center">
                                                <Path
                                                    Data="M854.016 739.328l-313.344-309.248-313.344 309.248q-14.336 14.336-32.768 21.504t-37.376 7.168-36.864-7.168-32.256-21.504q-29.696-28.672-29.696-68.608t29.696-68.608l376.832-373.76q14.336-14.336 34.304-22.528t40.448-9.216 39.424 5.12 31.232 20.48l382.976 379.904q28.672 28.672 28.672 68.608t-28.672 68.608q-14.336 14.336-32.768 21.504t-37.376 7.168-36.864-7.168-32.256-21.504z"
                                                    Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                    RenderTransformOrigin="0.5,0.5">
                                                    <Path.RenderTransform>
                                                        <TransformGroup>
                                                            <RotateTransform Angle="0" />
                                                        </TransformGroup>
                                                    </Path.RenderTransform>
                                                </Path>
                                            </Viewbox>
                                        </Border>
                                        <Border
                                            Width="25"
                                            Height="25"
                                            Padding="3,8,0,0"
                                            Panel.ZIndex="99"
                                            CornerRadius="0 0 5 5"
                                            MouseLeftButtonUp="GotoBottom"
                                            Style="{StaticResource BgHoverBorder}"
                                            ToolTip="去到顶部">

                                            <Viewbox
                                                Width="15"
                                                Height="auto"
                                                VerticalAlignment="Center">
                                                <Path
                                                    Data="M854.016 739.328l-313.344-309.248-313.344 309.248q-14.336 14.336-32.768 21.504t-37.376 7.168-36.864-7.168-32.256-21.504q-29.696-28.672-29.696-68.608t29.696-68.608l376.832-373.76q14.336-14.336 34.304-22.528t40.448-9.216 39.424 5.12 31.232 20.48l382.976 379.904q28.672 28.672 28.672 68.608t-28.672 68.608q-14.336 14.336-32.768 21.504t-37.376 7.168-36.864-7.168-32.256-21.504z"
                                                    Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                    RenderTransformOrigin="0.5,0.5">
                                                    <Path.RenderTransform>
                                                        <TransformGroup>
                                                            <RotateTransform Angle="180" />
                                                        </TransformGroup>
                                                    </Path.RenderTransform>
                                                </Path>
                                            </Viewbox>
                                        </Border>
                                    </StackPanel>

                                    <Border
                                        Grid.Row="1"
                                        Margin="0,5,0,0"
                                        Padding="0,3"
                                        Background="{DynamicResource Window.Side.Background}"
                                        CornerRadius="5"
                                        Tag="{Binding Name}">
                                        <StackPanel Orientation="Horizontal">
                                            <Button
                                                Grid.Column="1"
                                                Margin="5"
                                                HorizontalAlignment="Right"
                                                Click="ConnectPort"
                                                Tag="{Binding Name}">
                                                <Button.Style>
                                                    <Style BasedOn="{StaticResource FillButton}" TargetType="Button">
                                                        <Setter Property="Content" Value="连接" />
                                                        <Setter Property="Opacity" Value="1" />

                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Connected}" Value="True">

                                                                <Setter Property="Content" Value="断开" />
                                                                <Setter Property="Background" Value="Red" />
                                                                <Setter Property="super:CommonExt.HoverBackground" Value="Red" />
                                                            </DataTrigger>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Opacity" Value="0.7" />
                                                            </Trigger>


                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                            <Button
                                                Height="25"
                                                Margin="5,2,5,0"
                                                Padding="10,2"
                                                VerticalAlignment="Center"
                                                super:CommonExt.CornerRadius="5"
                                                Click="ClearData"
                                                Content="清屏"
                                                Style="{StaticResource ButtonDanger}"
                                                ToolTip="清空窗口">
                                                <!--<Viewbox
                                                    Width="15"
                                                    Height="auto"
                                                    Margin="2,5,4,4"
                                                    VerticalAlignment="Center">
                                                    <Path
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Data="M687.6 96.4H336.4v91.2h351.1V96.4zM636.7 398v405.5h-73.9V398h73.9z m-175.5 0v405.5h-73.9V398h73.9z m332.1-119.2H230.7l27.9 648.8h506.7l28-648.8zM696.8 5.1c40.4 0 73.3 35.6 73.9 79.8v102.7h147.8c20.2 0 36.6 17.8 37 39.9v41.2c0 5.5-4 10-9 10.1h-70.1L848 941.6c-1.8 42.9-33.7 76.6-72.6 77.3H249.8c-39 0-71.3-33.4-73.7-76l-0.1-1.3-28.5-662.7H77.7c-5 0-9.1-4.4-9.2-9.8v-40.9c0-22.2 16.2-40.2 36.3-40.5h148.4V86.2c0-44.3 32.5-80.4 72.7-81.1h370.9z"
                                                        Fill="{DynamicResource Window.Foreground}" />
                                                </Viewbox>-->
                                            </Button>
                                            <ToggleButton
                                                Width="auto"
                                                Height="auto"
                                                Margin="5,0"
                                                Padding="2,2,4,2"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Background="Transparent"
                                                Click="SetTextBoxScroll"
                                                Style="{StaticResource FlatToggleButton}"
                                                ToolTip="固定/滚屏">
                                                <Viewbox
                                                    Width="20"
                                                    Height="auto"
                                                    VerticalAlignment="Center">
                                                    <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                                                </Viewbox>
                                            </ToggleButton>


                                            <Button
                                                Width="27"
                                                Height="27"
                                                Margin="5,0"
                                                Click="OpenPath"
                                                Style="{StaticResource RoundNormalButton}"
                                                ToolTip="打开当前日志所在文件夹">
                                                <Viewbox
                                                    Width="20"
                                                    Height="20"
                                                    VerticalAlignment="Center">
                                                    <Path
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Data="M183.232 128c0 0-52.544 0 37.184 0 80.448 0 164.288 0 250.368 0 58.368 0 58.24 128.832 140.864 128.832 50.88 0 228.992 0 228.992 0C906.56 256.832 960 310.272 960 376.128l0 398.656c0 65.856-53.44 119.232-119.296 119.232L183.232 894.016C117.44 894.08 64 840.704 64 774.784L64 247.296C64 181.376 117.44 128 183.232 128z"
                                                        Fill="{DynamicResource Window.Foreground}" />
                                                </Viewbox>
                                            </Button>
                                            <Button
                                                Width="27"
                                                Height="27"
                                                Margin="5,0"
                                                Click="OpenByDefaultApp"
                                                Style="{StaticResource RoundNormalButton}"
                                                ToolTip="用默认应用打开当前日志">
                                                <Viewbox
                                                    Width="20"
                                                    Height="20"
                                                    VerticalAlignment="Center">
                                                    <Path
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Data="M565.8 887.6h-345v-751h361.6v187.1c0 19.9 16.1 36 36 36h187.4v115c0 19.9 16.1 36 36 36s36-16.1 36-36v-151c0-9.6-3.8-18.7-10.6-25.5L643.9 75.1c-0.6-0.6-1.2-1.1-1.8-1.6l-0.4-0.4-1.8-1.5s-0.1-0.1-0.2-0.1l-1.8-1.2-0.6-0.3c-0.6-0.4-1.3-0.8-2-1.1-0.1 0-0.2-0.1-0.2-0.1-0.6-0.3-1.2-0.6-1.9-0.9l-0.6-0.3c-0.7-0.3-1.4-0.6-2.1-0.8-0.1 0-0.1 0-0.2-0.1-0.7-0.2-1.4-0.5-2.1-0.7-0.2-0.1-0.4-0.1-0.6-0.2-0.7-0.2-1.5-0.4-2.3-0.5-0.7-0.1-1.5-0.3-2.3-0.4-0.2 0-0.4-0.1-0.6-0.1-0.7-0.1-1.4-0.2-2.2-0.2H202.1c-29.4 0-53.3 23.9-53.3 53.3v788.4c0 29.4 23.9 53.3 53.3 53.3h363.7c19.9 0 36-16.1 36-36s-16.1-36-36-36z m88.7-599.9V187.5l100.2 100.2H654.5z M921.6 870.7l-80.8-80.8c18.3-27.4 29-60.3 29-95.7 0-95-77-172.1-172.1-172.1-95 0-172.1 77-172.1 172.1 0 95 77 172.1 172.1 172.1 33.6 0 64.9-9.6 91.4-26.3l81.5 81.5c7 7 16.2 10.5 25.5 10.5s18.4-3.5 25.5-10.5c14.1-13.9 14.1-36.7 0-50.8zM597.7 694.3c0-55.2 44.9-100.1 100.1-100.1s100.1 44.9 100.1 100.1S753 794.4 697.8 794.4s-100.1-44.9-100.1-100.1z"
                                                        Fill="{DynamicResource Window.Foreground}" />
                                                </Viewbox>
                                            </Button>


                                            <CheckBox
                                                Margin="10"
                                                VerticalAlignment="Center"
                                                Content="加时间戳"
                                                FontSize="15"
                                                IsChecked="{Binding AddTimeStamp, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{StaticResource NormalCheckBox}" />

                                            <Button
                                                Margin="5,0"
                                                Click="SaveToNewFile"
                                                Content="存到新文件" />

                                            <ComboBox
                                                Name="highlightingComboBox"
                                                Width="100"
                                                Margin="5,0"
                                                VerticalAlignment="Center"
                                                Background="{DynamicResource Window.Title.Background}"
                                                ItemsSource="{Binding Source={x:Static avalonEdit:HighlightingManager.Instance}, Path=HighlightingDefinitions}"
                                                SelectedIndex="21"
                                                SelectedItem="{Binding SyntaxHighlighting, ElementName=textBox}"
                                                Style="{StaticResource BorderComboBox}" />
                                            <StackPanel Grid.Column="1" Orientation="Horizontal">

                                                <TextBox
                                                    MinWidth="100"
                                                    Background="Transparent"
                                                    Style="{StaticResource ReadOnlyTextBox}"
                                                    Text="{Binding RX, Mode=OneWay, StringFormat=RX {0}}"
                                                    TextWrapping="NoWrap" />

                                                <TextBox
                                                    MinWidth="100"
                                                    Background="Transparent"
                                                    Style="{StaticResource ReadOnlyTextBox}"
                                                    Text="{Binding TX, Mode=OneWay, StringFormat=TX {0}}"
                                                    TextWrapping="NoWrap" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <Grid
                                    Name="advancedGrid"
                                    Grid.Row="0"
                                    Margin="250,0,0,0"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Bottom"
                                    Panel.ZIndex="10"
                                    Visibility="Hidden">
                                    <Border
                                        Margin="5"
                                        Background="{DynamicResource Menu.Background}"
                                        CornerRadius="5"
                                        Effect="{StaticResource PopupDropShadowEffect}" />
                                    <StackPanel Margin="10" Orientation="Vertical">
                                        <StackPanel Margin="5,0" Orientation="Horizontal">
                                            <TextBlock
                                                Width="60"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="编码"
                                                TextAlignment="Right" />
                                            <ComboBox
                                                Width="100"
                                                SelectedIndex="0"
                                                Style="{StaticResource BorderComboBox}"
                                                Text="{Binding SerialPort.PortEncoding, Mode=TwoWay}">
                                                <ComboBoxItem>UTF8</ComboBoxItem>
                                                <ComboBoxItem>ASCII</ComboBoxItem>
                                                <ComboBoxItem>GBK</ComboBoxItem>
                                                <ComboBoxItem>GB2312</ComboBoxItem>
                                            </ComboBox>
                                        </StackPanel>
                                        <StackPanel Margin="5,0" Orientation="Horizontal">
                                            <TextBlock
                                                Width="60"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="Parity"
                                                TextAlignment="Right" />
                                            <ComboBox
                                                Width="100"
                                                SelectedIndex="0"
                                                Style="{StaticResource BorderComboBox}"
                                                Text="{Binding SerialPort.ParityString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                <ComboBoxItem>None</ComboBoxItem>
                                                <ComboBoxItem>Odd</ComboBoxItem>
                                                <ComboBoxItem>Even</ComboBoxItem>
                                                <ComboBoxItem>Mark</ComboBoxItem>
                                                <ComboBoxItem>Space</ComboBoxItem>
                                            </ComboBox>
                                        </StackPanel>
                                        <StackPanel Margin="5,0" Orientation="Horizontal">
                                            <TextBlock
                                                Width="60"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="StopBits"
                                                TextAlignment="Right" />
                                            <ComboBox
                                                Width="100"
                                                SelectedIndex="0"
                                                Style="{StaticResource BorderComboBox}"
                                                Text="{Binding SerialPort.StopBitsString, Mode=TwoWay}">
                                                <ComboBoxItem>One</ComboBoxItem>
                                                <ComboBoxItem>Two</ComboBoxItem>
                                                <ComboBoxItem>OnePointFive</ComboBoxItem>
                                            </ComboBox>
                                        </StackPanel>
                                        <Button
                                            Margin="0,10,0,5"
                                            VerticalAlignment="Bottom"
                                            Click="HideAdvancedGrid"
                                            Content="关闭" />
                                    </StackPanel>
                                </Grid>




                                <GridSplitter
                                    Grid.Row="1"
                                    Height="4"
                                    HorizontalAlignment="Stretch"
                                    Panel.ZIndex="10"
                                    Style="{StaticResource HoverSpliter}" />

                                <Grid Grid.Row="2">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Border
                                        Grid.Row="0"
                                        Padding="5,0"
                                        Background="{DynamicResource Window.Title.Background}"
                                        CornerRadius="5">
                                        <WrapPanel Orientation="Horizontal">
                                            <TextBlock Style="{StaticResource BaseTextBlock}" Text="BaudRate" />
                                            <ComboBox
                                                MinWidth="100"
                                                SelectedIndex="0"
                                                Style="{StaticResource BorderComboBox}"
                                                Text="{Binding SerialPort.BaudRate, Mode=TwoWay}">
                                                <ComboBoxItem>115200</ComboBoxItem>
                                                <ComboBoxItem>1500000</ComboBoxItem>
                                            </ComboBox>
                                            <TextBlock Style="{StaticResource BaseTextBlock}" Text="DataBits" />
                                            <ComboBox
                                                MinWidth="50"
                                                SelectedIndex="3"
                                                Style="{StaticResource BorderComboBox}"
                                                Text="{Binding SerialPort.DataBits, Mode=TwoWay}">
                                                <ComboBoxItem>5</ComboBoxItem>
                                                <ComboBoxItem>6</ComboBoxItem>
                                                <ComboBoxItem>7</ComboBoxItem>
                                                <ComboBoxItem>8</ComboBoxItem>
                                            </ComboBox>


                                            <Button
                                                Margin="5,0"
                                                Click="ShowAdvancedOptions"
                                                Content="高级设置" />



                                            <!--<TextBlock Style="{StaticResource BaseTextBlock}" Text="Flow Controls" />
                                            <ComboBox
                                                MinWidth="100"
                                                Background="{DynamicResource Window.Side.Background}"
                                                BorderBrush="{DynamicResource Window.Side.Hover.Background}"
                                                Foreground="{DynamicResource Window.Foreground}"
                                                ItemContainerStyle="{StaticResource NormalListBoxItem}"
                                                SelectedIndex="0"
                                                Style="{StaticResource BorderComboBox}"
                                                Tag="{DynamicResource Window.Side.Hover.Background}"
                                                ToolTip="{Binding RelativeSource={RelativeSource Mode=Self}, Path=Text}">
                                                <ComboBoxItem>None</ComboBoxItem>
                                                <ComboBoxItem>Hardware</ComboBoxItem>
                                                <ComboBoxItem>Software</ComboBoxItem>
                                                <ComboBoxItem>Custom</ComboBoxItem>
                                            </ComboBox>-->
                                        </WrapPanel>
                                    </Border>

                                    <Border
                                        Name="sendBorder"
                                        Grid.Row="1"
                                        Margin="0,5,0,0"
                                        Padding="5,0"
                                        Background="{DynamicResource Window.Title.Background}"
                                        CornerRadius="5"
                                        Tag="{Binding Name}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Button
                                                Grid.Column="0"
                                                Margin="5,0"
                                                Click="OpenSendPanel"
                                                Content="编辑命令" />

                                            <Button
                                                Grid.Column="1"
                                                Width="27"
                                                Height="27"
                                                Margin="5,0"
                                                Click="StartSendCommands"
                                                Style="{StaticResource RoundNormalButton}"
                                                ToolTip="启动"
                                                Visibility="Collapsed">
                                                <Viewbox
                                                    Width="20"
                                                    Height="20"
                                                    VerticalAlignment="Center">
                                                    <Path
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Data="M512 962c-248.512 0-450-201.487-450-450s201.487-450 450-450 450 201.487 450 450c0 248.512-201.487 450-450 450zM512 174.5c-177.525 0-337.5 159.975-337.5 337.5s159.975 337.5 337.5 337.5c177.525 0 337.5-159.975 337.5-337.5s-159.975-337.5-337.5-337.5zM466.494 682.719c-36.9 22.163-83.081-5.512-83.081-49.838v-241.706c0-44.325 46.125-72 83.081-49.838l201.431 120.881c36.9 22.162 36.9 77.513 0 99.675l-201.431 120.825z"
                                                        Fill="Green" />
                                                </Viewbox>
                                            </Button>
                                            <ComboBox
                                                Grid.Column="2"
                                                MinWidth="50"
                                                DisplayMemberPath="ProjectName"
                                                ItemsSource="{Binding Path=DataContext.SendCommandProjects, RelativeSource={RelativeSource AncestorType={x:Type super:BaseWindow}}}"
                                                SelectedIndex="0"
                                                SelectedValuePath="ProjectID"
                                                SelectionChanged="ComboBox_SelectionChanged"
                                                Style="{StaticResource BorderComboBox}" />
                                            <ScrollViewer
                                                Grid.Column="3"
                                                HorizontalScrollBarVisibility="Auto"
                                                PreviewMouseWheel="ScrollViewer_PreviewMouseWheel_1"
                                                VerticalScrollBarVisibility="Disabled">
                                                <ItemsControl Name="sendButtons" Margin="5,0">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <StackPanel Orientation="Horizontal" />
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Button
                                                                Margin="5,0"
                                                                BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                                Click="SendCustomCommand"
                                                                Content="{Binding Name, TargetNullValue=发送命令}"
                                                                Style="{StaticResource BorderButton}"
                                                                ToolTip="{Binding Command}" />
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>
                                        </Grid>
                                    </Border>


                                    <Grid
                                        Grid.Row="2"
                                        MinHeight="100"
                                        Tag="{Binding Name, Mode=OneWay}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="100" />
                                        </Grid.ColumnDefinitions>
                                        <Border
                                            Margin="0,5"
                                            Padding="10"
                                            Background="{DynamicResource Window.Side.Background}"
                                            CornerRadius="5">
                                            <TextBox
                                                Name="sendTextBox"
                                                Grid.Column="0"
                                                AcceptsReturn="False"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                CaretBrush="{DynamicResource Window.Foreground}"
                                                ContextMenu="{StaticResource TextBoxContextMenu}"
                                                Foreground="{DynamicResource Window.Foreground}"
                                                PreviewKeyDown="SendTextBox_PreviewKeyDown"
                                                ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                Text="{Binding WriteData, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                TextChanged="SendTextBox_TextChanged" />
                                        </Border>

                                        <Popup
                                            x:Name="sendHistoryPopup"
                                            Width="420"
                                            Height="auto"
                                            AllowsTransparency="True"
                                            HorizontalOffset="-10"
                                            Placement="Top"
                                            PlacementTarget="{Binding ElementName=sendTextBox}"
                                            PopupAnimation="Fade"
                                            StaysOpen="False"
                                            Tag="{Binding Name, Mode=OneWay}"
                                            VerticalOffset="-10">
                                            <Grid MaxHeight="600" Margin="5">
                                                <Border
                                                    Margin="5"
                                                    Background="{DynamicResource Menu.Background}"
                                                    Effect="{StaticResource PopupDropShadowEffect}" />
                                                <ScrollViewer
                                                    Width="390"
                                                    Margin="0,10"
                                                    HorizontalScrollBarVisibility="Hidden"
                                                    VerticalScrollBarVisibility="auto">
                                                    <ItemsControl
                                                        Name="itemsControl"
                                                        Margin="0,5"
                                                        Background="Transparent">
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <StackPanel />
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border
                                                                    x:Name="baseBorder"
                                                                    Margin="5,0"
                                                                    HorizontalAlignment="Stretch"
                                                                    BorderBrush="Transparent"
                                                                    BorderThickness="1"
                                                                    MouseEnter="HistoryMouseEnter"
                                                                    MouseLeave="HistoryMouseLeave"
                                                                    MouseLeftButtonDown="SetSendHistory"
                                                                    Style="{StaticResource HoverBorder}">
                                                                    <Grid>
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="*" />
                                                                            <ColumnDefinition Width="auto" />
                                                                        </Grid.ColumnDefinitions>
                                                                        <TextBlock
                                                                            Grid.Column="0"
                                                                            Style="{StaticResource BaseTextBlock}"
                                                                            Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Popup}}}"
                                                                            Text="{Binding Path=.}"
                                                                            TextAlignment="Left"
                                                                            TextTrimming="WordEllipsis"
                                                                            TextWrapping="NoWrap" />
                                                                        <Border
                                                                            Grid.Column="1"
                                                                            Background="Transparent"
                                                                            BorderBrush="{StaticResource TabItem.Selected.Background}"
                                                                            Tag="{Binding Path=.}">
                                                                            <Button
                                                                                Width="20"
                                                                                Height="20"
                                                                                Margin="5"
                                                                                HorizontalAlignment="Right"
                                                                                Click="DeleteSendHistory"
                                                                                Style="{StaticResource RoundNormalButton}"
                                                                                Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Popup}}}"
                                                                                Visibility="Visible">
                                                                                <Viewbox
                                                                                    Width="10"
                                                                                    Height="auto"
                                                                                    VerticalAlignment="Center">
                                                                                    <Path
                                                                                        HorizontalAlignment="Center"
                                                                                        VerticalAlignment="Center"
                                                                                        Data="M610.218667 505.6l398.08-387.413333a49.664 49.664 0 0 0 0-71.338667l-2.133334-2.133333a52.992 52.992 0 0 0-73.301333 0L534.784 432.64 136.704 44.373333a52.992 52.992 0 0 0-73.386667 0L61.269333 46.592a48.810667 48.810667 0 0 0 0 71.338667l398.165334 387.669333-398.165334 387.498667a49.664 49.664 0 0 0 0 71.253333l2.218667 2.133333c20.48 19.626667 52.821333 19.626667 73.301333 0l398.08-387.413333 398.08 387.413333c20.48 19.626667 52.906667 19.626667 73.386667 0l2.048-2.133333a49.664 49.664 0 0 0 0-71.253333l-398.08-387.413334z"
                                                                                        Fill="{DynamicResource TabItem.Hover.Foreground}" />
                                                                                </Viewbox>
                                                                            </Button>
                                                                        </Border>
                                                                    </Grid>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </ScrollViewer>
                                            </Grid>
                                        </Popup>

                                        <Grid Grid.Column="1">

                                            <ToggleButton
                                                Width="auto"
                                                Height="auto"
                                                Margin="5,8,8,5"
                                                Padding="2,4,4,4"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Top"
                                                Background="Transparent"
                                                IsChecked="{Binding AddNewLineWhenWrite, Mode=TwoWay}"
                                                Style="{StaticResource FlatToggleButton}"
                                                ToolTip="加回车换行">
                                                <Viewbox
                                                    Width="20"
                                                    Height="auto"
                                                    VerticalAlignment="Center">
                                                    <Path Data="M896 160C896 177.664 881.664 192 864 192l-768 0C78.336 192 64 177.664 64 160l0 0C64 142.336 78.336 128 96 128l768 0C881.664 128 896 142.336 896 160L896 160zM896 352C896 334.336 881.664 320 864 320l-768 0C78.336 320 64 334.336 64 352l0 0C64 369.664 78.336 384 96 384l768 0C881.664 384 896 369.664 896 352L896 352zM384 736C384 718.336 369.664 704 352 704l-256 0C78.336 704 64 718.336 64 736l0 0C64 753.664 78.336 768 96 768l256 0C369.664 768 384 753.664 384 736L384 736zM735.168 512 732.8 512 599.232 512 96 512C78.336 512 64 526.336 64 544S78.336 576 96 576l503.232 0 133.568 0 2.368 0c52.928 0 96 43.072 96 96s-43.072 96-96 96L568.96 768l0-2.112L568.576 765.888l64.128-64.128c12.8-12.8 12.8-33.664 0-46.528-12.864-12.864-33.6-12.864-46.528 0l-120.192 120.192c-6.208 6.208-9.6 14.592-9.6 23.296 0 8.704 3.456 17.024 9.6 23.232l120.192 120.128c12.864 12.736 33.6 12.736 46.528 0 12.864-12.864 12.864-33.6 0-46.592L569.024 832l166.208 0c88.256 0 160-71.744 160-160S823.424 512 735.168 512z" Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" />
                                                </Viewbox>
                                            </ToggleButton>

                                            <Button
                                                Margin="5,5,7,5"
                                                Padding="10"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Bottom"
                                                Click="SendCommand"
                                                Content="发送"
                                                Tag="{Binding Name}" />
                                        </Grid>


                                    </Grid>

                                </Grid>
                            </Grid>

                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
        </Grid>
        <Grid
            Grid.Row="2"
            Height="20"
            Background="{DynamicResource Window.StatusBar.Background}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <TextBox
                Grid.Column="0"
                Height="15"
                Margin="5,0"
                Padding="0"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                VerticalContentAlignment="Center"
                Background="Transparent"
                FontSize="12"
                Foreground="{DynamicResource Window.Foreground}"
                Style="{StaticResource ReadOnlyTextBox}"
                Text="{Binding StatusText}"
                TextWrapping="NoWrap" />

        </Grid>
    </Grid>
</super:BaseWindow>
